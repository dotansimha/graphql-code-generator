"use strict";(self.webpackChunk_graphql_codegen_website=self.webpackChunk_graphql_codegen_website||[]).push([[2711],{35318:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var a=t(27378);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var u=a.createContext({}),p=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(u.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=o,g=d["".concat(u,".").concat(m)]||d[m]||s[m]||i;return t?a.createElement(g,r(r({ref:n},c),{},{components:t})):a.createElement(g,r({ref:n},c))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=d;var l={};for(var u in n)hasOwnProperty.call(n,u)&&(l[u]=n[u]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},34263:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var a=t(25773),o=t(30808),i=(t(27378),t(35318)),r=["components"],l={id:"write-your-plugin",title:"Write your first Plugin"},u=void 0,p={unversionedId:"custom-codegen/write-your-plugin",id:"custom-codegen/write-your-plugin",isDocsHomePage:!1,title:"Write your first Plugin",description:"Basic Plugin",source:"@site/docs/custom-codegen/write-your-plugin.md",sourceDirName:"custom-codegen",slug:"/custom-codegen/write-your-plugin",permalink:"/docs/custom-codegen/write-your-plugin",editUrl:"https://github.com/dotansimha/graphql-code-generator/edit/master/website/docs/custom-codegen/write-your-plugin.md",tags:[],version:"current",frontMatter:{id:"write-your-plugin",title:"Write your first Plugin"},sidebar:"sidebar",previous:{title:"What are Plugins?",permalink:"/docs/custom-codegen/index"},next:{title:"Validate Plugin Configuration",permalink:"/docs/custom-codegen/validate-configuration"}},c=[{value:"Basic Plugin",id:"basic-plugin",children:[],level:2},{value:"Using the <code>GraphQLSchema</code>",id:"using-the-graphqlschema",children:[],level:2},{value:"Using the documents",id:"using-the-documents",children:[],level:2},{value:"Add plugin configuration",id:"add-plugin-configuration",children:[],level:2},{value:"Packing your Plugin",id:"packing-your-plugin",children:[],level:2}],s={toc:c};function d(e){var n=e.components,t=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"basic-plugin"},"Basic Plugin"),(0,i.kt)("p",null,"To get started with writing your GraphQL Code-Generator plugin, start by creating a simple ",(0,i.kt)("inlineCode",{parentName:"p"},"my-plugin.js")," file in your project, with the following content:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  plugin: (schema, documents, config) => {\n    return 'Hi!';\n  },\n};\n")),(0,i.kt)("p",null,"The exported object should match the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/dotansimha/graphql-code-generator/blob/e3af1dbc80a998444a1d1b353f127f297c6a09d0/packages/utils/plugins-helpers/src/types.ts#L552"},(0,i.kt)("inlineCode",{parentName:"a"},"CodegenPlugin"))," interface."),(0,i.kt)("p",null,"Now, let's try to load and use it with the codegen. Specify the path to your ",(0,i.kt)("inlineCode",{parentName:"p"},".js")," file in your ",(0,i.kt)("inlineCode",{parentName:"p"},"codegen.yml")," config file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"schema: my-schema.graphql\ndocuments: './src/**/*.graphql'\ngenerates:\n  output.ts:\n    - my-plugin.js\n")),(0,i.kt)("p",null,"Now, run the ",(0,i.kt)("inlineCode",{parentName:"p"},"@graphql-codegen/cli")," using ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql-codegen")," command, and it will create a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"output.ts")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"Hi!")),(0,i.kt)("h2",{id:"using-the-graphqlschema"},"Using the ",(0,i.kt)("inlineCode",{parentName:"h2"},"GraphQLSchema")),(0,i.kt)("p",null,"The first argument of your ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin")," function is the ",(0,i.kt)("inlineCode",{parentName:"p"},"GraphQLSchema"),". The code-generator will make sure to merge all ",(0,i.kt)("inlineCode",{parentName:"p"},"GraphQLSchema"),"s into a single, easy-to-use object, that you can use to create your output."),(0,i.kt)("p",null,"You can find the full, typed, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/graphql/graphql-js/blob/2df59f18dd3f3c415eaba57d744131a674079ddf/src/type/schema.ts#L129"},"API of ",(0,i.kt)("inlineCode",{parentName:"a"},"GraphQLSchema")," here")),(0,i.kt)("p",null,"So let's use a very basic method from ",(0,i.kt)("inlineCode",{parentName:"p"},"GraphQLSchema"),", and return a list of all GraphQL types declared in the schema:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  plugin: (schema, documents, config, info) => {\n    const typesMap = schema.getTypeMap();\n\n    return Object.keys(typesMap).join('\\n');\n  },\n};\n")),(0,i.kt)("h2",{id:"using-the-documents"},"Using the documents"),(0,i.kt)("p",null,"The second argument of your ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin")," method is an array of GraphQL documents. This array contains a list of ",(0,i.kt)("inlineCode",{parentName:"p"},"{ location: string, document: DocumentNode }"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"location")," field is the path of the file, and ",(0,i.kt)("inlineCode",{parentName:"p"},"DocumentNode")," is an object containing all GraphQL documents that has been found in that file."),(0,i.kt)("p",null,"You can find the full, typed, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/graphql/graphql-js/blob/main/src/language/ast.ts#L249-L253"},"API of ",(0,i.kt)("inlineCode",{parentName:"a"},"DocumentNode")," here")),(0,i.kt)("p",null,"Let's print a list of all documents files, and the name of operations in this file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  plugin: (schema, documents, config, info) => {\n    return documents\n      .map(doc => {\n        const docsNames = doc.document.definitions.map(def => def.name.value);\n\n        return `File ${doc.location} contains: ${docsNames.join(', ')}`;\n      })\n      .join('\\n');\n  },\n};\n")),(0,i.kt)("h2",{id:"add-plugin-configuration"},"Add plugin configuration"),(0,i.kt)("p",null,"The third argument of your function is ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," and it includes an object with the configuration passed to your plugin."),(0,i.kt)("p",null,"You can use it to tweak the behavior of your plugin and allow developers to customize the output easily."),(0,i.kt)("p",null,"You can pass configuration to your plugin in the following this way:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"schema: my-schema.graphql\ndocuments: './src/**/*.graphql'\ngenerates:\n  output.ts:\n    - my-plugin.js:\n        myConfig: 'some-value'\n")),(0,i.kt)("p",null,"And then, you can use in your plugin:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  plugin: (schema, documents, config, info) => {\n    if (extname(info.outputFile) === '.graphql') {\n      return 'baz';\n    }\n\n    if (config.myConfig === 'some-value') {\n      return 'foo';\n    } else {\n      return 'bar';\n    }\n  },\n};\n")),(0,i.kt)("h2",{id:"packing-your-plugin"},"Packing your Plugin"),(0,i.kt)("p",null,"To pack your Plugin as package, create a simple ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," file and add the ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," field, pointing to your Plugin file."),(0,i.kt)("p",null,"Then, publish it to npm using ",(0,i.kt)("inlineCode",{parentName:"p"},"npm publish")," and test it by installing the published package from npm, and use it in your YML config file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"schema: my-schema.graphql\ndocuments: './src/**/*.graphql'\ngenerates:\n  output.ts:\n    - my-custom-plugin-package\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"If you are using TypeScript to write your plugin, don't forget to compile your ",(0,i.kt)("inlineCode",{parentName:"p"},".ts")," file using ",(0,i.kt)("inlineCode",{parentName:"p"},"tsc"),", and point ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," to the compiled file.")))}d.isMDXComponent=!0}}]);